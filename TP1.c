#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>

/**
 * Exercice 1 !
 * Affiche le PID ainsi que celui de son père 
 */
void exo1()
{
    	printf("Bienvenu dans la question 1 : \n") ;
    	printf("Le numero du processus est : %d\n ", getpid());
    	printf("Le numero de son pere est : %d\n ",getppid());
}

/**
 * Exercice 2 !
 * Calucl la somme de deux chiffres donner en argument, s'éxécute seulement s'il
 * n'y a que deux nombre
 * 
 * @param argc = nombre d'argument
 * @param argv = tableau des arguments
 */
void exo2(int argc, char** argv)
{
    	printf("\n \n") ;
    	printf("Bienvenu dans la question 2 : \n") ;
    	if(argc != 3)
    	{
		printf("erreur nb argument\n");
    	}
    	else
    	{
		printf("somme : %d\n",atoi(argv[1])+atoi(argv[2]));
    	}
}

/**
 * Exercice 3 !
 * Calcul la somme des arguments passer dans la commande, renvoi faux s'il y a 
 * qu'un seul argument
 * 
 * @param argc = nombre d'argument
 * @param argv = tableau des arguments
 */
void exo3(int argc, char** argv)
{
	printf("\n \n") ;
    	printf("Bienvenu dans la question 3 : \n") ;
    	int sum = 0;
    	if(argc >= 2)
    	{
	 	for(int i = 0 ; i < argc ; i++)
	 	{
	     		sum += atoi(argv[i]);
	 	}

	 	printf("somme : %d\n",sum);
    	}
    	else
    	{
		printf("erreur\n");
    	}
}

//------------------------------ Exercice 5 ------------------------------------------------------
/**
 * Exercice 4 !
 * La ou on va annalyser le control-c et le mod de passe
 * 
 * @param sig [description]
 */
void exo4_bis(int sig)
{
    	printf("\n \n") ;
    	printf("Bienvenu dans la question 4 : \n") ;
    	char *password = "admin";
    	char test[30] ;
    	printf("Veuillez entrer le mod de passe : \n") ;
    	scanf("%s", test) ;
    	if(strcmp(test, password) == 0)
    	{
	     	signal(SIGINT, SIG_DFL) ;
	     	kill(getpid(), SIGINT) ;
    	}
    	else
    	{
	 	printf("pas le bon mot de passe \n");
	 	signal(SIGINT,exo4);
    	}
}

/**
 * Detecte le control-c à la fin du signal
 */
void exo4()
{
    	signal(SIGINT,exo4);
    	while(1)
    	{
	 	printf("attente signal ...\n");
	 	sleep(1);
    	}
}

//------------------------------------- Execice 5 -----------------------------------

/**
 * Dit bonjour
 */
void fonctionhello()
{
  	printf("hello !\n");
}

/**
 * Dit aurevoir
 */
void fonctionBye()
{
  	printf("bye !\n");
}


/**
 * Exercice 5 !
 * Gère l'affichage entre le "hello" / "bye"
 */
void exo5()
{
    	pid_t pid = fork();
  	while(1)
  	{
    		if(pid == 0)
    		{
			signal(SIGALRM,fonctionhello);
			alarm(1);
			pause();
    		}
    		else
    		{
			signal(SIGALRM,fonctionBye);
			alarm(5);
			pause();
    		}
  	}
}

/**
 * Exercice 6 !
 * Tue le processus au bout d'un certain moment
 * 
 * @param argc [description]
 * @param argv [description]
 */
void exo6(int argc, char** argv)
{
	if(argc != 3)
  	{
    		printf("erreur argument\n");
  	}
  	else
  	{
    		sleep(atoi(argv[2]));
    		kill((pid_t)(argv[1]),SIGKILL);
  	}
}


main(int argc, char** argv)
{
    	exo1() ;
    	exo2(argc, argv) ;
    	exo3(argc, argv) ;
    	exo4() ;

    	//exo5() ;
    	exo6(argc, argv) ;

    	return 0 ;
}
